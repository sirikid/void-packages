# Template file for 'wxWidgets'
pkgname=wxWidgets
version=3.0.5.1
revision=1
build_style=gnu-configure
configure_args="--enable-mediactrl --enable-unicode
 --with-gtk=3 --with-libmspack --with-libnotify --with-opengl --with-sdl"
hostmakedepends="pkg-config"
makedepends="SDL2-devel gst-plugins-base1-devel gstreamer1-devel gtk+3-devel
 libmspack-devel libnotify-devel tiff-devel webkit2gtk-devel glu-devel"
short_desc="WxWidgets GUI toolkit library compiled with gtk3 support"
maintainer="Helmut Pozimski <helmut@pozimski.eu>"
license="custom:wxWindows"
homepage="https://www.wxwidgets.org"
distfiles="https://github.com/wxWidgets/wxWidgets/releases/download/v${version}/wxWidgets-${version}.tar.bz2"
checksum=440f6e73cf5afb2cbf9af10cec8da6cdd3d3998d527598a53db87099524ac807

_version_suffix=$(cut -f1,2 -d. <<<"$version")

post_install() {
	vlicense docs/licence.txt LICENSE
}

wxWidgets-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/bin
		vmove usr/include
		vmove usr/lib/"*.so"
		vmove usr/lib/wx
		vmove usr/share/aclocal

		# remove all occurrences of $XBPS_CROSS_TRIPLET
		# wx-config:
		#   - mark this build as native build
		#   - ignore --host option; breaks configure scripts when
		#     cross compiling (isnâ€™t necessary in our case anyway)
		if [ "$CROSS_BUILD" ]; then
			rename "${XBPS_CROSS_TRIPLET}-" "" ${PKGDESTDIR}/usr/lib/wx/{config,include}/*
			rename -- "-${XBPS_CROSS_TRIPLET}" "" ${PKGDESTDIR}/usr/lib/*

			vsed -i ${PKGDESTDIR}/usr/lib/wx/config/gtk3-unicode-"$_version_suffix" \
				-e "s/${XBPS_CROSS_TRIPLET}-//g" \
				-e "s/-${XBPS_CROSS_TRIPLET}//g" \
				-e 's/is_cross()  { \[ "xyes" = "xyes" \]; }/is_cross()  { \[ "xno" = "xyes" \]; }/g' \
				-e 's/--\*=\*)/--host=\*) continue;;\n\n    --\*=\*)/'
		fi
	}
}
