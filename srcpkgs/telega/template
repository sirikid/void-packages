# Template file for 'telega'
pkgname=telega
version=0.7.1
revision=1
wrksrc="telega.el-${version}"
build_wrksrc="server"
build_style=gnu-makefile
make_check_target="test"
makedepends="libtd-devel"
checkdepends="python3"
short_desc="GNU Emacs telegram client (unofficial)"
maintainer="Ivan Sokolov <ivan-p-sokolov@ya.ru>"
license="GPL-3.0-or-later"
homepage="https://github.com/zevlg/telega.el"
distfiles="https://github.com/zevlg/telega.el/archive/v${version}.tar.gz"
checksum=7cd24461a17aa95f9c48a56cddde7280ecc22c15373699dab3486f4b806b34bc

pre_build() {
	CFLAGS+=" -pthread"
	LDFLAGS+=" -ltdjson"
	export CFLAGS LDFLAGS
}

pre_check() {
	vsed -i run_tests.py -e '/^TELEGA_SERVER/s@~/.telega/@./@'
}

do_install() {
	vbin telega-server
}
